"use strict";(self.webpackChunkevantay_com=self.webpackChunkevantay_com||[]).push([[323],{7583:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>a,toc:()=>c});var i=t(4848),s=t(8453);const r={title:"PiHole DNS et Ad block",author:"Mathieu Bannwarth",author_url:"https://github.com/WhiteRoseLK/",author_title:"Cybersecurity IT engineer",author_image_url:"https://avatars.githubusercontent.com/u/50756181"},o=void 0,a={id:"homelab/2024-05-31-PiHole",title:"PiHole DNS et Ad block",description:"Passionn\xe9 de CyberS\xe9curit\xe9 la protection des donn\xe9es fais parti des choses qui ont une certaine importance pour moi et qui sont malheureusement trop souvent oubli\xe9 par le commun des mortels.",source:"@site/docs/homelab/2024-05-31-PiHole.md",sourceDirName:"homelab",slug:"/homelab/2024-05-31-PiHole",permalink:"/docs/homelab/2024-05-31-PiHole",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"PiHole DNS et Ad block",author:"Mathieu Bannwarth",author_url:"https://github.com/WhiteRoseLK/",author_title:"Cybersecurity IT engineer",author_image_url:"https://avatars.githubusercontent.com/u/50756181"},sidebar:"docsSidebar",previous:{title:"HomePage dashboard",permalink:"/docs/homelab/2024-05-31-HomePage"},next:{title:"HashiCorp Vault Associate 002",permalink:"/docs/formations/2024-09-09-HashiCorp-Vault"}},l={},c=[{value:"Installation",id:"installation",level:2},{value:"Terraform",id:"terraform",level:3},{value:"Ansible",id:"ansible",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Configuration DNS",id:"configuration-dns",level:3}];function u(e){const n={code:"code",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Passionn\xe9 de CyberS\xe9curit\xe9 la protection des donn\xe9es fais parti des choses qui ont une certaine importance pour moi et qui sont malheureusement trop souvent oubli\xe9 par le commun des mortels."}),"\n",(0,i.jsx)(n.p,{children:"Afin de reprendre un petit contr\xf4le sur les informations qui peuvent sortir de chez moi, j'ai d\xe9cid\xe9 de d\xe9ployer un PiHole dans mon HomeLab.\nCe serveur permet de remplacer le serveur DNS. Pour 99% des gens c'est votre box internet qui joue ce r\xf4le."}),"\n",(0,i.jsx)(n.p,{children:"PiHole permet de r\xe9aliser du filtrage sur les noms de domaines (FQDN) qui sont accessibles depuis vos \xe9quipements en bloquants les domaines ind\xe9sirables."}),"\n",(0,i.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,i.jsx)(n.h3,{id:"terraform",children:"Terraform"}),"\n",(0,i.jsx)(n.p,{children:"Mon fichier de variable est classique, pas besoin d'augmenter les ressources de la VM :"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",metastring:'title="terraform.tfvars"',children:'vm_name        = "PiHole"\nvm_target_node = "proxmox"\nvm_vmid        = 102\nvm_desc        = "PiHole"\nvm_onboot      = true\nvm_startup     = "1"\nvm_vm_state    = "running"\nvm_agent       = 1\nvm_clone       = "Template-Ubuntu-24.04"\nvm_memory      = 2048\nvm_cores       = 2\nvm_size        = "10G"\nvm_storage     = "SSD"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"ansible",children:"Ansible"}),"\n",(0,i.jsx)(n.p,{children:"Le r\xf4le ansible permet d'installer PiHole. Le template permet de d\xe9poser sur le serveur un fichier de reconfiguration qui permet ensuite de lancer l'installation de mani\xe8re silencieuse. Mon template est pr\xe9sent ci-dessous. Vous pouvez reprendre le m\xeame ou cr\xe9er le votre. Pour cela je vous conseil de lancer le script d'installation de PiHole manuellement puis de r\xe9cup\xe9rer le fichier qui aura \xe9t\xe9 g\xe9n\xe9r\xe9."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-YAML",metastring:'title="roles/PiHole/tasks/main.yml"',children:'---\n# tasks file for PiHole\n- name: Download PiHole script\n  get_url:\n    url: https://install.pi-hole.net\n    dest: /opt/basic-install.sh\n    mode: 744\n  \n- name: Create PiHole Directory\n  file:\n    path: /etc/pihole\n    state: directory\n\n- name: Copy PiHole initial variables\n  template:\n    src: PiHole.setupVars.j2\n    dest: /etc/pihole/setupVars.conf\n\n- name: Run PiHole script\n  shell: /opt/basic-install.sh --unattended\n\n- name: Change PiHole password\n  command: "pihole -a -p {{ admin_password }}"\n\n- name: Change PiHole FQDN\n  lineinfile:\n    path: /etc/lighttpd/conf-enabled/15-pihole-admin.conf\n    search_string: "$HTTP[\\"host\\"] == \\"pi.hole\\" {"\n    line: "$HTTP[\\"host\\"] == \\"{{ fqdn }}\\" {"\n  \n- name: Restart lighttpd\n  service:\n    name: lighttpd\n    state: restarted\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-YAML",metastring:'title="roles/PiHole/templates/pihole.setupVars.j2"',children:"PIHOLE_INTERFACE=ens18\nPIHOLE_DNS_1=1.1.1.1\nPIHOLE_DNS_2=1.0.0.1\nQUERY_LOGGING=true\nINSTALL_WEB_SERVER=true\nINSTALL_WEB_INTERFACE=true\nLIGHTTPD_ENABLED=true\nCACHE_SIZE=10000\nDNS_FQDN_REQUIRED=true\nDNS_BOGUS_PRIV=true\nDNSMASQ_LISTENING=local\nBLOCKING_ENABLED=true\n\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Une fois d\xe9ploy\xe9, le service est disponible sur le port ",(0,i.jsx)(n.strong,{children:"80"})]}),"\n",(0,i.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsx)(n.p,{children:"Une fois connect\xe9, l'interface ressemble \xe0 \xe7a :"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"PiHole Dashboard",src:t(2428).A+"",width:"3456",height:"2234"})}),"\n",(0,i.jsx)(n.h3,{id:"configuration-dns",children:"Configuration DNS"}),"\n",(0,i.jsxs)(n.p,{children:["Comme pr\xe9cis\xe9 plus haut, PiHole fait aussi de serveur DNS. On peut donc ajouter des entr\xe9s DNS local via l'onglet ",(0,i.jsx)(n.strong,{children:"Local DNS"}),"."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"PiHole Local DNS",src:t(5781).A+"",width:"3456",height:"2234"})})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},2428:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/PiHole_Dashboard-40bb155a98398d6c67b976e8a5f0f7cc.png"},5781:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/PiHole_Local_DNS-4251c5aa77b3aad2a4465787a9561045.png"},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var i=t(6540);const s={},r=i.createContext(s);function o(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);