"use strict";(self.webpackChunkevantay_com=self.webpackChunkevantay_com||[]).push([[307],{9204:(e,r,i)=>{i.r(r),i.d(r,{assets:()=>l,contentTitle:()=>t,default:()=>d,frontMatter:()=>o,metadata:()=>a,toc:()=>u});var s=i(4848),n=i(8453);const o={title:"Proxmox: Installation de A \xe0 Z",author:"Mathieu Bannwarth",author_url:"https://github.com/WhiteRoseLK/",author_title:"Cybersecurity IT engineer",author_image_url:"https://avatars.githubusercontent.com/u/50756181"},t=void 0,a={id:"homelab/2024-05-25-Proxmox-Install",title:"Proxmox: Installation de A \xe0 Z",description:"Cela fait des ann\xe9es que je r\xeave de pouvoir avoir mon propre HomeLab afin de pouvoir m'amuser ! Mais aussi afin de pouvoir plus facilement tester certaines applications sans avoir besoin d'avoir recourt \xe0 des VMs directement sur mon Mac.",source:"@site/docs/homelab/2024-05-25-Proxmox-Install.md",sourceDirName:"homelab",slug:"/homelab/2024-05-25-Proxmox-Install",permalink:"/docs/homelab/2024-05-25-Proxmox-Install",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Proxmox: Installation de A \xe0 Z",author:"Mathieu Bannwarth",author_url:"https://github.com/WhiteRoseLK/",author_title:"Cybersecurity IT engineer",author_image_url:"https://avatars.githubusercontent.com/u/50756181"},sidebar:"docsSidebar",previous:{title:"Sonarr, les s\xe9ries",permalink:"/docs/homelab/arr/2024-06-10-Sonarr"},next:{title:"Proxmox, cr\xe9ation d'un template packer",permalink:"/docs/homelab/2024-05-26-Proxmox-Template-Packer copy"}},l={},u=[{value:"Architecture initiale",id:"architecture-initiale",level:2},{value:"Installation",id:"installation",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Ajout disques",id:"ajout-disques",level:2},{value:"Repositories",id:"repositories",level:2},{value:"ISO",id:"iso",level:2},{value:"Deploy",id:"deploy",level:2}];function c(e){const r={a:"a",h2:"h2",img:"img",p:"p",strong:"strong",...(0,n.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.p,{children:"Cela fait des ann\xe9es que je r\xeave de pouvoir avoir mon propre HomeLab afin de pouvoir m'amuser ! Mais aussi afin de pouvoir plus facilement tester certaines applications sans avoir besoin d'avoir recourt \xe0 des VMs directement sur mon Mac."}),"\n",(0,s.jsx)(r.p,{children:"Il faut aussi avouer que l'id\xe9e d'avoir chez soit son propre mat\xe9riel est assez sexy je trouve \ud83d\ude44"}),"\n",(0,s.jsx)(r.p,{children:"Je me suis donc mis \xe0 la recherche de serveurs sur leboncoin, et j'ai rapidement pu trouver les deux premi\xe8res briques de mon Home-lab :"}),"\n",(0,s.jsx)(r.p,{children:"TODO: Add Photos"}),"\n",(0,s.jsx)(r.p,{children:"Ses deux b\xe9b\xe9s sont deux serveurs Dell PowerEdge 720.\nLe premier dispose de 96Go de Ram et de deux CPU Intel Xeon E5-2667 v2 cadenc\xe9 \xe0 3.3GHz et disposant de 8 Coeurs (16 Threads)\nLe second dispose de 64Go de Ram et du m\xeame CPU que le premier mais en mono socket."}),"\n",(0,s.jsx)(r.p,{children:"N'ayant pas besoin de deux serveurs pour le moment, et n'ayant rien pour les relier entre eux, j'ai d\xe9cid\xe9 de basculer toute la Ram du second dans le premier."}),"\n",(0,s.jsx)(r.p,{children:"je dispose donc d'un serveur avec 160Go de Ram en th\xe9orie. Une barrette semble \xeatre d\xe9fectueuse, j'ai donc en r\xe9alit\xe9 144Go de Ram disponibles pour monter mon Proxmox."}),"\n",(0,s.jsx)(r.h2,{id:"architecture-initiale",children:"Architecture initiale"}),"\n",(0,s.jsx)(r.p,{children:"N'ayant pour le moment aucun \xe9quipement r\xe9seau (Switch, Router, Firewall, etc.) j'ai du faire avec ce que j'avais sous la main.\nEt comme si cela ne suffisait pas, je me retrouve avec une seconde difficult\xe9. Je n'ai dans la pi\xe8ce qu'un seul c\xe2ble RJ45 reli\xe9 \xe0 ma box.\nMais il est reli\xe9 \xe0 ma tour qui ne poss\xe8de pas de carte WIFI."}),"\n",(0,s.jsx)(r.p,{children:"Ayant par nature horreur de devoir faire plusieurs fois la m\xeame choses, il \xe9tait inconcevable de devoir \xe0 chaque fois migrer mon c\xe2ble entre la tour et le serveur.\nDe plus cela voulait dire qu'en cas d'utilisation de la tour, j'aurais \xe9t\xe9 dans l'incapacit\xe9 de joindre mon serveur."}),"\n",(0,s.jsx)(r.p,{children:"J'ai donc r\xe9fl\xe9chis et j'ai finis par relier le serveur de la mani\xe8re suivante :"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.img,{alt:"Sch\xe9ma HomeLab V1",src:i(3868).A+"",width:"4196",height:"1627"})}),"\n",(0,s.jsx)(r.p,{children:"Pour faire simple, le serveur est reli\xe9 directement sur un r\xe9p\xe9teur Wifi pr\xe9sent dans la pi\xe8ce ce qui lui permet de se connecter \xe0 la box pr\xe9sente dans le salon et donc d'avoir acc\xe8s \xe0 internet."}),"\n",(0,s.jsx)(r.p,{children:"L'iDRAC lui est branch\xe9 sur ma RasPi 5 qui ne me servait pas pour le moment.\nLa RasPi est connect\xe9e en Wifi sur ma box, je peux donc facilement y avoir acc\xe8s en cas de probl\xe8me en r\xe9alisant un tunnel SSH au travers de cette derni\xe8re."}),"\n",(0,s.jsx)(r.h2,{id:"installation",children:"Installation"}),"\n",(0,s.jsxs)(r.p,{children:["Pour commencer, il faut r\xe9cup\xe9rer l'ISO d'installation de Proxmox pr\xe9sent ",(0,s.jsx)(r.a,{href:"https://www.proxmox.com/en/downloads/proxmox-virtual-environment/iso",children:"ici"}),". Pour ma part la derni\xe8re version est la 8.2"]}),"\n",(0,s.jsxs)(r.p,{children:["Une fois l'iso t\xe9l\xe9charg\xe9, il suffit de cr\xe9er une cl\xe9 USB bootable. Plusieurs m\xe9thodes existent j'ai l'habitude d'utiliser ",(0,s.jsx)(r.a,{href:"https://www.ventoy.net/en/index.html",children:"Ventoy"})," qui me permet d'avoir plusieurs iso sur la m\xeame cl\xe9 USB."]}),"\n",(0,s.jsx)(r.p,{children:"Il en reste plus qu'a booter sur la cl\xe9 USB. Vous obtiendrez alors l'\xe9cran suivant :"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.img,{alt:"Boot Proxmox",src:i(4095).A+"",width:"3456",height:"2234"})}),"\n",(0,s.jsx)(r.p,{children:"Choisir l'installation graphique et appuyer sur entrer."}),"\n",(0,s.jsx)(r.p,{children:"L'installation peut prendre un peu de temps. Une fois termin\xe9e, il faut accepter les conditions d'utilisations puis choisir le disque d'installation de Proxmox."}),"\n",(0,s.jsx)(r.p,{children:"Il s'agit du disque o\xf9 le syst\xe8me va \xeatre installer, il est recommand\xe9 d'en choisir un d\xe9di\xe9 mais vous pouvez tr\xe8s bien r\xe9utiliser le m\xeame que pour vos VMs."}),"\n",(0,s.jsx)(r.p,{children:"Pour ma part il s'agit d'un disque de 300Go qui sera d\xe9di\xe9 \xe0 Proxmox."}),"\n",(0,s.jsx)(r.p,{children:"Une fois le disque choisi, on rentre s\xe9lectionne la TimeZone et le clavier, puis on configure un mot de passe pour Proxmox."}),"\n",(0,s.jsx)(r.p,{children:"Attention il s'agit du mot de passe Root de Proxmox. Veillez \xe0 bien le noter et \xe0 ce qu'il respecte les bonnes pratiques (longueurs, complexit\xe9s, etc.)"}),"\n",(0,s.jsx)(r.p,{children:"On termine l'installation en s\xe9lectionnant une interface pour Proxmox, ainsi qu'une configuration r\xe9seau (FQDN, IP, DNS, etc.)"}),"\n",(0,s.jsx)(r.p,{children:"Si toute les informations remplies sont correctes, on valide une derni\xe8re fois puis on attend le temps de l'installation."}),"\n",(0,s.jsx)(r.h2,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsx)(r.p,{children:"Une fois l'installation termin\xe9e, vous pouvez y connecter via l'IP ou le FQDN configur\xe9 plus t\xf4t sur le port 8006 avec le compte Root et le mot de passe configur\xe9 lors de l'installation."}),"\n",(0,s.jsx)(r.p,{children:"Avant de d\xe9ployer les premi\xe8res machines, on va commencer par configurer les disques."}),"\n",(0,s.jsx)(r.p,{children:"Comme expliqu\xe9 plus haut, j'ai fais le choix d'installer Proxmox sur un disque \xe0 part, je vais donc commencer par supprimer le disque local-lvm qui a \xe9t\xe9 cr\xe9\xe9 au d\xe9marrage."}),"\n",(0,s.jsx)(r.p,{children:"Pour cela, il suffit de cliquer sur le Datacenter sur la gauche de l'\xe9cran et, dans la section storage, choisir la ligne local-lvm et cliquer sur Remove."}),"\n",(0,s.jsx)(r.p,{children:"Il faut aussi supprimer la partition data qui avait \xe9t\xe9 provisionn\xe9e, pour cela il faut aller sur le noeud Proxmox et dans la section Disks/LVM-Thin supprimer la partition data."}),"\n",(0,s.jsx)(r.p,{children:"Une fois supprim\xe9, il faut encore r\xe9allouer l'espace lib\xe9r\xe9 au syst\xe8me."}),"\n",(0,s.jsx)(r.p,{children:"Toujours sur le noeud, on ouvre le shell et on tape les commandes suivantes :"}),"\n",(0,s.jsx)(r.p,{children:"lvextend pve/root -l +100%FREE\nresize2fs /dev/pve/root"}),"\n",(0,s.jsx)(r.p,{children:"Si tout a correctement fonctionn\xe9, l'onglet summary devrait nous montrer une taille de disque \xe9gale \xe0 celle du disque complet :"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.img,{alt:"Proxmox Disk 1",src:i(1786).A+"",width:"1250",height:"388"})}),"\n",(0,s.jsx)(r.h2,{id:"ajout-disques",children:"Ajout disques"}),"\n",(0,s.jsx)(r.p,{children:"Maintenant que le premier disque est correctement configur\xe9, il me reste \xe0 ajouter les autres disques."}),"\n",(0,s.jsx)(r.p,{children:"Pour ce serveur je dispo de 4 SSD 1To configur\xe9s en RAID 5 ainsi que 3 HDD 1To configur\xe9s en RAID 0"}),"\n",(0,s.jsx)(r.p,{children:"Les SSD vont servir pour la cr\xe9ation des VMs."}),"\n",(0,s.jsx)(r.p,{children:"Je r\xe9serve les HDD pour r\xe9aliser un test d'installation de TrueNAS avec un acc\xe8s direct aux disques. L'espace sera ensuite transform\xe9 en partage r\xe9seau pour mon archi multim\xe9dia (Radarr, Sonarr, Plex, etc.)"}),"\n",(0,s.jsxs)(r.p,{children:["Je commence par cr\xe9er le volume group LVM pour les SSD, pour cela il suffit d'acc\xe9der au noeud Proxmox puis Disks/LVM.\nIl suffit alors de cliquer sur ",(0,s.jsx)(r.strong,{children:"Create"})," et de choisir la bonne partition, pour moi ",(0,s.jsx)(r.strong,{children:"/dev/sda"})," :"]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.img,{alt:"SSD Volume Group",src:i(3458).A+"",width:"746",height:"480"})}),"\n",(0,s.jsx)(r.h2,{id:"repositories",children:"Repositories"}),"\n",(0,s.jsx)(r.p,{children:"Avant de commencer \xe0 cr\xe9er ma premi\xe8re VM, j'en profite pour modifier les repositories de Proxmox pour supprimer ceux de la version entreprise."}),"\n",(0,s.jsx)(r.p,{children:'Dans updates/Repositories, il suffit de supprimer les sources list qui sont Tag comme \xe9tant enterprise et d\'ajouter une source list "No-Subscription"'}),"\n",(0,s.jsx)(r.h2,{id:"iso",children:"ISO"}),"\n",(0,s.jsxs)(r.p,{children:["Enfin, je vais ajouter un iso afin de commencer \xe0 d\xe9ployer mes premi\xe8res VMs. Pour cela je commence par choisir l'iso que je veux. Pour mon Home-lab j'ai choisis de partir sur ",(0,s.jsx)(r.a,{href:"https://releases.ubuntu.com/noble/",children:"Ubuntu 24.04"}),"."]}),"\n",(0,s.jsxs)(r.p,{children:["Une fois choisi, il suffit de se rendre sur le datastore ",(0,s.jsx)(r.strong,{children:"local"})," puis dans ",(0,s.jsx)(r.strong,{children:"ISO Images"})," de choisir de t\xe9l\xe9charger \xe0 partir d'une URL."]}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.img,{alt:"Ubuntu 24.04",src:i(6759).A+"",width:"1290",height:"650"})}),"\n",(0,s.jsx)(r.p,{children:"Mon Proxmox est maintenant pr\xeat \xe0 d\xe9ployer des VMs !"}),"\n",(0,s.jsx)(r.h2,{id:"deploy",children:"Deploy"}),"\n",(0,s.jsx)(r.p,{children:"Mon objectif \xe9tant d'automatiser tout mon d\xe9ploiement de VMs, ma premi\xe8re VM va donc me servir de base pour d\xe9ployer les autres, je l'ai nomm\xe9e Deploy"}),"\n",(0,s.jsx)(r.p,{children:"C'est a peu de choses pr\xeat la seule VM que je d\xe9ploierais manuellement."})]})}function d(e={}){const{wrapper:r}={...(0,n.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},3868:(e,r,i)=>{i.d(r,{A:()=>s});const s=i.p+"assets/images/Architecture-287760df43c1054c9f126395af6a69f6.png"},4095:(e,r,i)=>{i.d(r,{A:()=>s});const s=i.p+"assets/images/Boot-Proxmox-d166a20fae5fd1c520bef0dc7de632d4.png"},1786:(e,r,i)=>{i.d(r,{A:()=>s});const s=i.p+"assets/images/Proxmox-disk-1-c54f5219f3f090e810e4689629fd3f57.png"},3458:(e,r,i)=>{i.d(r,{A:()=>s});const s=i.p+"assets/images/SSD-Volume-Group-50edc3ec9a120116c88825d0cf12eb49.png"},6759:(e,r,i)=>{i.d(r,{A:()=>s});const s=i.p+"assets/images/Ubuntu-24.04-e5adc8145a612dfdbf4123371c0f4c40.png"},8453:(e,r,i)=>{i.d(r,{R:()=>t,x:()=>a});var s=i(6540);const n={},o=s.createContext(n);function t(e){const r=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:t(e.components),s.createElement(o.Provider,{value:r},e.children)}}}]);